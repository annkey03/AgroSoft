<!DOCTYPE html>
<html lang="es">
    {% load static %}
<head>

    <meta charset="UTF-8">
    <title>Producción Agrícola</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f7f7f7; }
        .navbar {
            background: #388E3C;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .navbar a {
            color: #fff;
            text-decoration: none;
            margin-right: 20px;
            font-weight: bold;
        }
        .navbar a:last-child { margin-right: 0; }
        .container { max-width: 1200px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px #0001; }
        .btn { background: #4CAF50; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; }
        .btn:hover { background: #388E3C; }
        .btn-info { background: #17a2b8; }
        .btn-warning { background: #ffc107; color: #000; }
        h2 { margin-top: 0; }
        .card { margin-bottom: 20px; }
        .chart-container { position: relative; height: 300px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="navbar">
        <div>
            <a href="{% url 'home' %}">Home</a>
            {% if user.is_authenticated and user.tipo == 'admin' %}
                <a href="{% url 'admin_dashboard' %}">Panel Admin</a>
            {% endif %}
        </div>
        <div>
            {% if user.is_authenticated %}
                <a href="{% url 'logout' %}">Cerrar sesión</a>
                {% endif %}
            </div>
            <div class="navbar-right">
                <a href="{% url 'home' %}">Home</a>
                <a href="{% url 'productos' %}">Productos</a>
            </div>
        </div>

        <div class="sub-navbar">
            <p class="zones">Zona De Cultivo Principal
                <select class="combo-box" id="zonas" name="zonas">
                <option>...</option>
                <option value="madrid">Madrid</option>
                <option value="facatativa">Facatativa</option>
                <option value="funza">Funza</option>
                <option value="mosquera">Mosquera</option>
            </select>
            </p>
            <a class="btn-create" href="{% url 'solicitar_recomendacion' %}">+Cultivar</a>
        </div>

        <div class="container">
            <h4>Recomendaciones del dia de hoy</h4>
            <ul>
                <li><strong>Cultivo:</strong> {{ cultivo }}</li>
                <li><strong>Cantidad:</strong> {{ cantidad }} kg</li>
                <li><strong>Fecha de siembra:</strong> {{ fecha_siembra|date:"d/m/Y" }}</li>
                <li><strong>Fecha estimada de cosecha:</strong> {{ fecha_cosecha|date:"d/m/Y" }}</li>
                <li><strong>Días de cultivo:</strong> {{ dias }} días</li>
                <li><strong>Viabilidad:</strong> {{ viabilidad }}</li>
                <li><strong>Clima actual:</strong> {{ clima }}</li>
            </ul>
        </div>

        <div class="containers">
            <div class="container-graphics">
                <h3>Graficas</h3>
            </div>
            <div class="container-weather">
                <h3>Clima</h3>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>Bienvenido al sistema de producción agrícola</h2>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
        {% endif %}
        
        {% if user.is_authenticated %}
            <p>Hola, {{ user.username }}.</p>
            
            <div class="row mb-4">
                <div class="col-md-12">
                    {% if user.tipo == 'agricultor' %}
                        <a href="{% url 'solicitar_recomendacion' %}" class="btn btn-success mb-2">Solicitar recomendación de cultivo</a>
                    {% endif %}
                    
                    {% if user.tipo == 'admin' %}
                        <a href="{% url 'admin_dashboard' %}" class="btn btn-warning mb-2">
                            <i class="bi bi-speedometer2"></i> Panel Administrativo
                        </a>
                    {% endif %}
                </div>
            </div>

            <!-- Gráficos de producción -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Producción por Cultivo</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="produccionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Precio del Mercado - Algodón</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="algodonChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráfico de viabilidad -->
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Viabilidad de Cultivos</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="viabilidadChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Estadísticas Generales</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6">
                                    <h6>Total de Cultivos</h6>
                                    <p class="h4 text-primary">125</p>
                                </div>
                                <div class="col-6">
                                    <h6>Ingresos Totales</h6>
                                    <p class="h4 text-success">$145,000</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% if user.tipo == 'agricultor' %}
                <div class="card mt-4">
                    <div class="card-header">
                        <h5>Mis Solicitudes Recientes</h5>
                    </div>
                    <div class="card-body">
                        {% if solicitudes_recientes %}
                            <ul class="list-group">
                                {% for solicitud in solicitudes_recientes %}
                                    <li class="list-group-item">
                                        <strong>{{ solicitud.cultivo_deseado }}</strong> - 
                                        {{ solicitud.fecha|date:"d/m/Y" }} - 
                                        <span class="badge bg-{% if solicitud.estado == 'procesada' %}success{% else %}warning{% endif %}">
                                            {{ solicitud.estado }}
                                        </span>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-muted">No tienes solicitudes recientes.</p>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        
        {% else %}
            <p>Por favor, <a href="{% url 'registro' %}">regístrate</a> o <a href="{% url 'login' %}">inicia sesión</a>.</p>
        {% endif %}
    </div>

    <script>
    // Datos de ejemplo para los gráficos
    document.addEventListener('DOMContentLoaded', function() {
        // Gráfico de producción por cultivo
        const ctx = document.getElementById('produccionChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Maíz', 'Frijol', 'Arroz', 'Café', 'Plátano'],
                datasets: [{
                    label: 'Producción (toneladas)',
                    data: [120, 85, 95, 45, 75],
                    backgroundColor: [
                        '#FF6384',
                        '#36A2EB',
                        '#FFCE56',
                        '#4BC0C0',
                        '#9966FF'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Gráfico de precio del mercado - Algodón
        const ctx2 = document.getElementById('algodonChart').getContext('2d');
        new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                datasets: [{
                    label: 'Precio por quintal (USD)',
                    data: [85.50, 92.30, 88.75, 95.20, 91.80, 97.45],
                    backgroundColor: 'rgba(255, 206, 86, 0.8)',
                    borderColor: 'rgba(255, 206, 86, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Precio (USD por quintal)'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Cultivo exclusivo de la Sabana de Occidente'
                    }
                }
            }
        });

        // Gráfico de viabilidad
        const ctx3 = document.getElementById('viabilidadChart').getContext('2d');
        new Chart(ctx3, {
            type: 'pie',
            data: {
                labels: ['Alta', 'Media', 'Baja'],
                datasets: [{
                    data: [45, 35, 20],
                    backgroundColor: [
                        '#4BC0C0',
                        '#FFCE56',
                        '#FF6384'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    });
    </script>
</body>
</html>
